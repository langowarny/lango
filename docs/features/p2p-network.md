---
title: P2P Network
---

# P2P Network

!!! warning "Experimental"

    The P2P networking system is experimental. The protocol and configuration may change in future releases.

Lango supports decentralized agent-to-agent connectivity via libp2p. The Sovereign Agent Network (SAN) enables peer-to-peer communication with DID-based identity, zero-knowledge enhanced handshake, and a knowledge firewall for access control.

## Overview

The P2P subsystem enables direct agent communication without centralized coordination:

- **Direct connectivity** -- agents connect peer-to-peer using libp2p with Noise encryption
- **DID-based identity** -- each agent derives a `did:lango:<pubkey>` identity from its wallet
- **Knowledge firewall** -- default deny-all ACL controls which peers can access which tools
- **Agent discovery** -- GossipSub-based agent card propagation for capability-based search
- **ZK-enhanced handshake** -- optional zero-knowledge proof verification during peer authentication

```mermaid
graph TB
    subgraph Agent A
        WA[Wallet] --> IDA[DID Provider]
        IDA --> NA[P2P Node]
        NA --> FWA[Firewall]
        NA --> DA[Discovery]
    end

    subgraph Agent B
        WB[Wallet] --> IDB[DID Provider]
        IDB --> NB[P2P Node]
        NB --> FWB[Firewall]
        NB --> DB[Discovery]
    end

    NA <-- "Noise-encrypted\nlibp2p stream" --> NB
    DA <-- "GossipSub\nagent cards" --> DB

    style NA fill:#7c3aed,color:#fff
    style NB fill:#7c3aed,color:#fff
```

## Identity

Each Lango agent derives a decentralized identifier (DID) from its wallet's compressed secp256k1 public key:

```
did:lango:<hex-compressed-pubkey>
```

The DID is deterministically mapped to a libp2p peer ID, ensuring cryptographic binding between the wallet identity and the network identity. Private keys never leave the wallet layer.

## Handshake

When two agents connect, they perform mutual DID-based authentication:

1. **TCP/QUIC connection** established via libp2p with Noise encryption
2. **DID exchange** -- each peer presents its `did:lango:...` identifier
3. **Signature verification** -- DID public key is verified against the peer ID
4. **Session token** -- a time-limited session token is issued for subsequent queries
5. **(Optional) ZK proof** -- when `p2p.zkHandshake` is enabled, a zero-knowledge proof of identity is verified

Session tokens have a configurable TTL (`p2p.sessionTokenTtl`). Expired tokens require re-authentication.

## Knowledge Firewall

The knowledge firewall enforces access control for peer queries. The default policy is **deny-all** -- explicit rules must be added to allow access.

### ACL Rules

Each rule specifies:

| Field | Description |
|-------|-------------|
| `peerDid` | Peer DID this rule applies to (`"*"` for all peers) |
| `action` | `"allow"` or `"deny"` |
| `tools` | Tool name patterns (supports `*` wildcard, empty = all tools) |
| `rateLimit` | Maximum requests per minute (0 = unlimited) |

### Response Sanitization

All responses to peer queries are automatically sanitized:

- Absolute file paths are redacted
- Sensitive fields (passwords, tokens, private keys) are stripped
- Internal IDs and database paths are removed

### ZK Attestation

When `p2p.zkAttestation` is enabled, responses include a zero-knowledge proof that the response was generated by the claimed agent without revealing internal state.

## Discovery

Agent discovery uses GossipSub for decentralized agent card propagation:

1. Each agent publishes its **Agent Card** periodically on the `/lango/agentcard/1.0.0` topic
2. Cards include: name, description, DID, multiaddrs, capabilities, pricing, and ZK credentials
3. Peers can search for agents by capability tag using `FindByCapability`
4. ZK credentials on cards are verified before acceptance

### Agent Card Structure

```json
{
  "name": "my-agent",
  "description": "Research assistant",
  "did": "did:lango:02abc...",
  "multiaddrs": ["/ip4/1.2.3.4/tcp/9000"],
  "capabilities": ["research", "code-review"],
  "pricing": {
    "currency": "USDC",
    "perQuery": "0.01"
  },
  "peerId": "QmAbc..."
}
```

## ZK Circuits

When ZK features are enabled, Lango uses four zero-knowledge circuits:

| Circuit | Purpose |
|---------|---------|
| Identity | Prove DID ownership without revealing the private key |
| Membership | Prove membership in an authorized peer set |
| Range | Prove a value falls within a range (e.g., reputation score) |
| Attestation | Prove response authenticity without revealing internal state |

Configure the proving scheme via `p2p.zkp.provingScheme` (`"plonk"` or `"groth16"`).

## Configuration

> **Settings:** `lango settings` â†’ P2P Network

```json
{
  "p2p": {
    "enabled": true,
    "listenAddrs": ["/ip4/0.0.0.0/tcp/9000"],
    "bootstrapPeers": [],
    "keyDir": "~/.lango/p2p",
    "enableRelay": false,
    "enableMdns": true,
    "maxPeers": 50,
    "handshakeTimeout": "30s",
    "sessionTokenTtl": "1h",
    "autoApproveKnownPeers": false,
    "firewallRules": [
      {
        "peerDid": "*",
        "action": "allow",
        "tools": ["search_*"],
        "rateLimit": 10
      }
    ],
    "gossipInterval": "30s",
    "zkHandshake": false,
    "zkAttestation": false,
    "zkp": {
      "proofCacheDir": "~/.lango/zkp",
      "provingScheme": "plonk"
    }
  }
}
```

See the [Configuration Reference](../configuration.md#p2p-network) for all P2P settings.

## REST API

When the gateway is running (`lango serve`), read-only P2P endpoints are available for monitoring and external integrations:

| Endpoint | Description |
|----------|-------------|
| `GET /api/p2p/status` | Peer ID, listen addresses, connected peer count |
| `GET /api/p2p/peers` | List of connected peers with multiaddresses |
| `GET /api/p2p/identity` | Local DID (`did:lango:...`) and peer ID |

```bash
# Check node status
curl http://localhost:18789/api/p2p/status

# List connected peers
curl http://localhost:18789/api/p2p/peers

# Get DID identity
curl http://localhost:18789/api/p2p/identity
```

These endpoints query the running server's persistent P2P node. They are public (no authentication) and expose only node metadata. See the [HTTP API Reference](../gateway/http-api.md#p2p-network) for response format details.

## CLI Commands

The CLI commands create ephemeral P2P nodes for one-off operations, independent of the running server:

```bash
lango p2p status               # Show node status
lango p2p peers                # List connected peers
lango p2p connect <multiaddr>  # Connect to a peer
lango p2p disconnect <peer-id> # Disconnect from a peer
lango p2p firewall list        # List firewall rules
lango p2p firewall add         # Add a firewall rule
lango p2p discover             # Discover agents
lango p2p identity             # Show local identity
```

See the [P2P CLI Reference](../cli/p2p.md) for detailed command documentation.
